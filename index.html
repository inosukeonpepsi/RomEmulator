<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DS Player</title>
<link href="asset/dark.css" rel="stylesheet">
<style>
html, body {
    overflow-x: hidden;
    user-select: none;
    margin:0;
    padding:0;
    width:100vw;
    height:100vh;
    background:black;
    color:white;
    font-family: 'Helvetica', sans-serif;
}
canvas { position:absolute; z-index:1; }
</style>
</head>
<body>

<div id="welcome" class="menu">
    <h1>DS Player</h1>
    <div id="loading">Loading...</div>
    <div id="loadrom">
        <input id="rom" type="file" hidden>
        <button id="btn-choose-file">Choose File (or drag/drop)...</button>
    </div>
    <p style="color:#888;">
        Your files are processed locally. Not affiliated with Nintendo.
    </p>
</div>

<div id="player" hidden>
    <canvas id="top" width="256" height="192"></canvas>
    <canvas id="bottom" width="256" height="192"></canvas>
</div>

<script src="asset/localforage.js"></script>
<script src="asset/pako.min.js"></script>
<script src="asset/app.js"></script>
<script>
    var jsFile = "build/nds.js";
    if(localStorage && localStorage['simd'] == "1") jsFile = "build-simd/nds.js";
    var script = document.createElement('script');
    script.src = jsFile;
    document.body.appendChild(script);

    // Helper to start a ROM
    function startROM(romBytes) {
        player.hidden = false;
        welcome.hidden = true;
        nds.loadROM(new Uint8Array(romBytes));
        nds.start();
    }

    // Local file upload
    const fileInput = document.getElementById('rom');
    const btnChoose = document.getElementById('btn-choose-file');
    btnChoose.onclick = ()=>fileInput.click();
    fileInput.onchange = async (e)=>{
        const file = e.target.files[0];
        if(!file) return;
        const buf = await file.arrayBuffer();
        startROM(buf);
    };

    // Drag & drop
    document.body.addEventListener('dragover', e=>e.preventDefault());
    document.body.addEventListener('drop', async e=>{
        e.preventDefault();
        const file = e.dataTransfer.files[0];
        if(file) {
            const buf = await file.arrayBuffer();
            startROM(buf);
        }
    });

    // Load ROM from repo URL
    async function loadROMFromURL(url) {
        const res = await fetch(url);
        const buf = await res.arrayBuffer();
        startROM(buf);
    }

    // Example: automatically load a repo-hosted ROM
    // Uncomment and change path if you want
    // loadROMFromURL('KirbysAdventure.nds');
</script>

</body>
</html>
